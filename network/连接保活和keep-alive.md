## 什么时候连接会“死”
在没有数据读写的“静默连接”上，TCP虚拟的链路在默认的情况下，还**真没有任何数据往来**，TCP没有对连接的 **“突然死亡”** 是没有任何处理能力的，突然死亡是指没有经过正常的四次挥手流程连接就断开，这一般是由于一端的机器掉电挂了，或者FIN报文不可达（？）。

## 突然死亡会发生什么
- 如果客户端突然死亡，服务端会维持一个已经失效的套接字四元组，服务端会发现自己永远都收不到来自客户端的报文了
- 如果服务端突然死亡，客户端会维持一个已经失效的套接字四元组，客户端再发送报文时可能不可达（如果服务端没有重启），也有可能被服务端重置连接，导致客户端发出SIGPIPE杀死进程，我想可能还会“串话”（？）

## 避免突然死亡：探活
### tcp提供了Keep-Alive的选项：
- 定义一个时间段，在这个时间段内，如果没有任何连接相关的活动，TCP 保活机制会开始作用，每隔一个时间间隔，发送一个探测报文，该探测报文包含的数据非常少，如果连续几个探测报文都没有得到响应，则认为当前的 TCP 连接已经死亡，系统内核将错误信息通知给上层应用程序。
- 系统默认的7200秒没有活动，就每隔75秒发送心跳包，连续9次都失败，就认为连接突然死亡
### 应用层探活
思路和tcp提供的类似，只是定时器使用多路复用的超时或创建定时器的事件来完成。

## 其他
- **UDP需要这样的机制吗？** 不需要，UDP都没有连接的概念，何来连接保活的说法。（魔改除外）