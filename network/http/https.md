## http的缺陷
- 通信是明文，会被抓包
- 不验证通信方的身份，可能会被伪造请求（只能通过cookie等本地缓存机制来确定请求是否来自从一个客户端）
- 无法验证报文的完整性，比如下载的内容无法确定就一定和服务器下发的一样（中间人攻击），相当于插入了一个截胡的代理

## https是怎么做的
- https = http + 加密 + 认证 + 完整性保护
- 在tcp和http中间加了一层TLS（以前是SSL）

## 公钥加密法
- 也叫非对称式秘钥，是加密解密的一种算法
- 它需要两个密钥，一个是公开密钥，另一个是私有密钥；公钥用作加密，私钥则用作解密。使用公钥把明文加密后所得的密文，只能用相对应的私钥才能解密并得到原本的明文，最初用来加密的公钥不能用作解密
- 公钥可以公开，可任意向外发布；私钥不可以公开，必须由用户自行严格秘密保管

## 公钥如何保证不被篡改
- server在向client发送公钥的时候，不能保证不被篡改
- 所以采用第三方认证的形式，只能信任第三方可信机构颁发的数字证书（公钥）

## 第三方的公钥怎么交到用户手里？
- 如果又采用通信的方式，是很困难的
- 一般浏览器内置了

## 为什么tls需要握手
因为如果双方的双边通信都采用公钥加密，私钥解密的非对称加密法，开销会很高，所以利用这个机制去协商一个只有双方知道的对称秘钥是最好的。

## tls握手过程

        随机数1、协议和加密信息
client -------------------------------------------------------------------> server


        随机数2、协议和加密信息、服务器证书（包含公钥）
server -------------------------------------------------------------------> client


        随机数3（用服务器公钥加密的，基于随机数1/2）、协议和加密信息、编码改变通知
client -------------------------------------------------------------------> server （单边握手结束）


接下来的阶段client和server都用随机数3生成同一个对称秘钥（基于之前协商好的加密信息）


        编码改变通知
server -------------------------------------------------------------------> client （单边握手结束）


## 为什么tls握手要3个随机数
因为tls不信任每个主机都可以产生真丶随机数，如果不能产生真丶随机数的话，就可能会被攻击者猜出来。所以使用前两个随机数来生成第三个随机数，这样的随机性就比较好了，难以猜测

## 那么接下来呢？
接下来就是HTTP通信了，只是其内容是经过上面协商后的对称秘钥加密过的