## 异步消息队列
使用redis的list作为异步消息队列，lpush+rpop

## 问题来了，队列空了怎么办?
这并不像单机可以通过epoll让内核帮忙polling，而是通过网络协议的用户态查询，一旦pop操作返回失败，当然是不能一直尝试pop的，这样会大大降低Redis的有效QPS，有效选择有：
- 让客户端的线程sleep一会儿再pop（就有点类似于非阻塞的socket读写），但这样会显著增加消息的延迟
- 使用blpop，如果list为空的话，socket就不会返回信息，直到有数据。那客户端就会阻塞在epoll_wait上，而不用用户态polling了

## blpop的问题
blpop看起来很完美，但是存在一个问题：服务器可能会定期踢掉空闲的连接，这个时候read就会返回失败了。所以要注意处理这种异常情况。